# Hardware Setup Guide

This document provides detailed hardware connection and configuration information for the ESP32-S3 Drone Sensor & Camera System.

## Table of Contents

- [Bill of Materials](#bill-of-materials)
- [Wiring Diagrams](#wiring-diagrams)
- [Component Setup](#component-setup)
- [Power Considerations](#power-considerations)
- [Troubleshooting Hardware Issues](#troubleshooting-hardware-issues)

## Bill of Materials

### Required Components

| Qty | Component | Model/Spec | Purpose | Notes |
|-----|-----------|------------|---------|-------|
| 1 | Microcontroller | ESP32-S3 DevKitC-1 | Main processor | Must have PSRAM (2MB or more) |
| 1 | GPS Module | Generic NEO-6M/NEO-7M | Position tracking | 3.3V compatible, UART output |
| 1 | Pressure Sensor | BMP280 (GY-BMP280) | Altitude measurement | I2C interface, 3.3V |
| 1 | Camera Module | OV7670 | Image/video capture | Without FIFO buffer |
| 1 | Breadboard | Standard size | Prototyping | Or custom PCB |
| 1 | Power Supply | 5V 2A USB | Power delivery | Or battery pack |
| - | Jumper Wires | Male-to-Female | Connections | Various lengths |

### Optional Components

| Qty | Component | Purpose | Notes |
|-----|-----------|---------|-------|
| 2 | 4.7kΩ Resistors | I2C pull-ups | May be on-board sensor modules |
| 1 | Capacitor 100μF | Power filtering | Reduces noise, improves stability |
| 1 | Level Shifter | 5V ↔ 3.3V conversion | Only if using 5V components |

## Wiring Diagrams

### GPS Module (UART Connection)

```
GPS Module          ESP32-S3
──────────          ────────
VCC (3.3V)    ──►   3.3V
GND           ──►   GND
TX            ──►   GPIO 16 (RX)
RX            ──►   GPIO 17 (TX)
```

**Notes:**
- GPS TX connects to ESP32 RX (crossed connection)
- GPS RX connection is optional (for sending config commands)
- Ensure GPS module operates at 3.3V logic levels

### BMP280 Sensor (I2C Connection)

```
BMP280              ESP32-S3
──────              ────────
VCC (3.3V)    ──►   3.3V
GND           ──►   GND
SDA           ──►   GPIO 8
SCL           ──►   GPIO 9
```

**Notes:**
- I2C pull-up resistors (4.7kΩ) are usually on sensor module
- Default I2C address is typically 0x76 or 0x77
- Use I2C scanner code to verify address if unsure

### OV7670 Camera Module (Parallel Connection)

```
OV7670              ESP32-S3          Function
──────              ────────          ────────
3.3V          ──►   3.3V              Power
GND           ──►   GND               Ground
SIOD          ──►   GPIO 15           I2C Data (Configuration)
SIOC          ──►   GPIO 18           I2C Clock (Configuration)
VSYNC         ──►   GPIO 13           Vertical Sync
HREF          ──►   GPIO 14           Horizontal Reference
PCLK          ──►   GPIO 12           Pixel Clock
XCLK          ──►   GPIO 11           Master Clock (from ESP32)
D0            ──►   GPIO 1            Data Bit 0
D1            ──►   GPIO 2            Data Bit 1
D2            ──►   GPIO 3            Data Bit 2
D3            ──►   GPIO 4            Data Bit 3
D4            ──►   GPIO 5            Data Bit 4
D5            ──►   GPIO 6            Data Bit 5
D6            ──►   GPIO 7            Data Bit 6
D7            ──►   GPIO 10           Data Bit 7
RESET         ──►   3.3V              Keep camera active
PWDN          ──►   GND               Disable power-down
```

**Notes:**
- OV7670 requires 3.3V power and logic levels
- RESET should be pulled HIGH (3.3V) for normal operation
- PWDN should be pulled LOW (GND) to keep camera active
- All data lines (D0-D7) must be connected
- XCLK is generated by ESP32 using LEDC peripheral

### Complete System Wiring Overview

```
                         ┌─────────────────────┐
                         │    ESP32-S3         │
                         │   DevKitC-1         │
                         ├─────────────────────┤
                         │                     │
    ┌──────────┐         │  GPIO 1-7,10 ─────────┐
    │  GPS     │         │                     │  │
    │  Module  │────────►│  GPIO 16 (RX)      │  │
    │          │         │  GPIO 17 (TX)      │  │
    └──────────┘         │                     │  │
                         │                     │  │
    ┌──────────┐         │  GPIO 8  (SDA) ────┼──┼───┐
    │  BMP280  │────────►│  GPIO 9  (SCL) ────┼──┼───┼──┐
    │  Sensor  │         │                     │  │   │  │
    └──────────┘         │  GPIO 11-15,18 ────┼──┘   │  │
                         │                     │      │  │
                         │  USB ◄──── Power   │      │  │
                         │                     │      │  │
                         └─────────────────────┘      │  │
                                   │                  │  │
                                   └──────────────────┼──┤
                                                      │  │
                                        ┌─────────────┴──┴───┐
                                        │    OV7670 Camera   │
                                        │      Module        │
                                        └────────────────────┘
```

## Component Setup

### ESP32-S3 DevKitC-1 Board

**Verification Steps:**
1. Connect via USB to computer
2. Check that device appears in Device Manager (Windows) or `lsusb` (Linux)
3. Install CH340 or CP2102 drivers if not automatically detected
4. Verify PSRAM is available (check with `ESP.getFreePsram()`)

**Important Notes:**
- ESP32-S3 has two USB ports: one for programming (USB-to-Serial), one for native USB
- Use the USB port closest to the edge for programming
- PSRAM is essential for camera operation

### GPS Module Configuration

**Initial Setup:**
1. Connect GPS antenna (if external)
2. Position GPS module with clear view of sky
3. Allow 30-60 seconds for initial satellite acquisition (cold start)
4. Verify NMEA sentences on serial output

**Testing GPS:**
```cpp
// Enable raw NMEA output in main.cpp
#define ECHO_RAW_NMEA 1
```

**Expected Output:**
```
$GPGGA,123519,4807.038,N,01131.000,E,1,08,0.9,545.4,M,46.9,M,,*47
$GPGSV,2,1,08,01,40,083,46,02,17,308,41,12,07,344,39,14,22,228,45*75
```

### BMP280 Sensor Configuration

**I2C Address Detection:**
- Default addresses: 0x76 or 0x77
- Use I2C scanner to detect (uncomment in `setup()`)
- Some modules have solder jumper to change address

**Calibration:**
- BMP280 has factory calibration stored in EEPROM
- No user calibration required
- For accurate altitude, input local sea level pressure

**Testing BMP280:**
```cpp
// Verify readings are reasonable
Temperature: 20-30°C (room temperature)
Pressure: 95000-105000 Pa (varies with weather/altitude)
```

### OV7670 Camera Configuration

**Focusing the Lens:**
1. Rotate lens housing clockwise to focus on distant objects
2. Rotate counter-clockwise for close focus
3. Test with `/capture` endpoint while adjusting
4. Lock focus with small drop of glue when optimal

**Image Quality Settings:**
- Adjust `jpeg_quality` in camera config (lower = better)
- Modify exposure settings via sensor controls
- Try different frame sizes for speed vs quality trade-off

## Power Considerations

### Power Requirements

| Component | Voltage | Current (Typical) | Current (Peak) |
|-----------|---------|-------------------|----------------|
| ESP32-S3 | 3.3V | 80-160 mA | 500+ mA (WiFi TX) |
| GPS Module | 3.3V | 30-50 mA | 100 mA |
| BMP280 | 3.3V | 2-3 mA | 5 mA |
| OV7670 | 3.3V | 60-80 mA | 150 mA |
| **Total** | **3.3V** | **~200 mA** | **~800 mA** |

### Power Supply Recommendations

**USB Power:**
- Minimum: 5V 1A USB power supply
- Recommended: 5V 2A USB power supply
- ESP32-S3's onboard regulator converts 5V to 3.3V

**Battery Power:**
- 3.7V LiPo battery (1000+ mAh recommended)
- Use 3.3V LDO regulator (e.g., AMS1117-3.3)
- Add protection circuit for over-discharge
- Runtime estimate: 1000mAh ÷ 200mA ≈ 5 hours

**Power Filtering:**
```
5V ──┬──[100μF]──┬── GND
     │           │
     └──► 3.3V Regulator
            │
            └──[10μF]── 3.3V to Components
```

### Reducing Power Consumption

**WiFi Power Management:**
```cpp
// Reduce WiFi transmit power
WiFi.setTxPower(WIFI_POWER_11dBm);  // vs. default 19.5dBm

// Use WiFi sleep modes when streaming not active
WiFi.setSleep(true);
```

**Camera Power Optimization:**
```cpp
// Reduce frame rate
delay(100);  // vs. delay(50) for slower streaming

// Lower resolution
config.frame_size = FRAMESIZE_QQVGA;  // 160x120
```

**Sensor Measurement Intervals:**
```cpp
// Increase intervals between readings
if (millis() - lastBmpPrint >= 5000) {  // vs. 2000ms
```

## Troubleshooting Hardware Issues

### ESP32-S3 Not Recognized

**Symptoms:** Computer doesn't detect ESP32 when connected via USB

**Solutions:**
1. Try different USB cable (data-capable, not charge-only)
2. Install CH340/CP2102 drivers manually
3. Try both USB ports on ESP32-S3 board
4. Check Device Manager for "Unknown Device"
5. Put board in download mode: Hold BOOT button, press RESET, release BOOT

### GPS No Fix

**Symptoms:** GPS doesn't report location, no satellite lock

**Solutions:**
1. Move to location with clear view of sky (outdoors preferred)
2. Wait longer (cold start can take 60+ seconds)
3. Check GPS TX/RX connections (should be crossed)
4. Verify GPS module LED is blinking (indicates searching)
5. Check baud rate matches GPS module (usually 9600)
6. Enable `ECHO_RAW_NMEA` to see if any data received

### BMP280 Not Detected

**Symptoms:** "Could not find BMP280 sensor" error message

**Solutions:**
1. Verify I2C connections (SDA to GPIO 8, SCL to GPIO 9)
2. Check power supply (3.3V and GND)
3. Run I2C scanner to detect address
4. Try both addresses (0x76 and 0x77)
5. Verify pull-up resistors on I2C lines (usually on module)
6. Test with another I2C device to verify ESP32 I2C function

### Camera Initialization Fails

**Symptoms:** "Camera init failed with error 0x..." message

**Solutions:**
1. Verify all 18 camera pins are correctly connected
2. Check PWDN is connected to GND
3. Check RESET is connected to 3.3V
4. Verify camera module receives stable 3.3V power
5. Confirm PSRAM is enabled (`ESP.getFreePsram()` > 0)
6. Try reducing XCLK frequency: `config.xclk_freq_hz = 10000000;`
7. Check for loose connections in breadboard

### Poor Camera Image Quality

**Symptoms:** Blurry, noisy, or distorted images

**Solutions:**
1. Adjust camera lens focus manually
2. Ensure adequate lighting (OV7670 needs good light)
3. Increase JPEG quality: `jpg_quality = 70` (lower number)
4. Enable/disable auto gain and exposure
5. Clean camera lens with soft cloth
6. Verify all data lines connected properly
7. Reduce camera resolution for testing

### System Crashes or Resets

**Symptoms:** ESP32 resets during operation, especially when streaming

**Solutions:**
1. Check power supply can provide sufficient current (2A recommended)
2. Add capacitors near power inputs (100μF recommended)
3. Verify PSRAM is working: `Serial.println(ESP.getFreePsram());`
4. Reduce WiFi transmit power: `WiFi.setTxPower(WIFI_POWER_11dBm);`
5. Decrease camera frame rate (increase delay)
6. Monitor free heap: `ESP.getFreeHeap()` should not approach zero
7. Disable watchdog temporarily for debugging: `disableCore0WDT();`

### WiFi Connection Problems

**Symptoms:** Cannot connect to ESP32 access point

**Solutions:**
1. Verify AP started successfully (check serial monitor for IP)
2. Check WiFi password is at least 8 characters
3. Forget network on client device and reconnect
4. Try connecting with different device (phone, laptop)
5. Ensure WiFi channel isn't congested (AP may auto-select)
6. Reset ESP32 and wait for full initialization
7. Check router isn't blocking new connections

## Safety Considerations

### Electrical Safety

⚠️ **Important Warnings:**
- Always disconnect power before changing wiring
- Do not exceed component voltage ratings (3.3V for most)
- Use proper gauge wire for current requirements
- Ensure no short circuits before applying power
- Add fuse protection for battery-powered operation

### Thermal Management

- ESP32-S3 can get warm during WiFi transmission
- Ensure adequate ventilation around components
- Consider heatsink for extended high-power operation
- Keep camera module below 70°C for reliability

### Mechanical Considerations

- Secure all connections with hot glue or tape in mobile applications
- Protect camera lens from scratches
- Use strain relief on wires subject to movement
- Consider vibration isolation for drone applications

---

**Last Updated:** December 2025

For additional support, please refer to:
- [Main README](README.md)
- Component datasheets (linked in Bill of Materials)
- ESP32-S3 Technical Reference Manual
